class_name Chain
extends Line2D

@export var chain_length: int = 10
@export var distance_between_segment: float = 10.0
@export var follow_speed: float = 0.1

var time: float = 0.0

func _ready() -> void:
	for i in range(chain_length):
		var pos := Vector2(i * distance_between_segment, 0)
		add_point(pos)


func _process(_delta: float) -> void:
	for i in range(1, chain_length):
		var current_segment: Vector2 = get_point_position(i)
		var next_segment: Vector2 = get_point_position(i - 1)

		var direction: Vector2 = (current_segment - next_segment).normalized()
		var target_position: Vector2 = next_segment + direction * distance_between_segment

		var new_pos: Vector2 = current_segment.lerp(target_position, follow_speed)
		set_point_position(i, new_pos)

	set_end(get_global_mouse_position())


func set_end(pos: Vector2) -> void:
	set_point_position(chain_length - 1, pos)

